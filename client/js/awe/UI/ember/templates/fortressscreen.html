<script type="text/x-handlebars" data-template-name="interactive-building">
{{#if "tooltip"}}
  {{#if "model.building"}}
    {{#view AWE.UI.Ember.ToolTipView classNames="mouse-over" mouseXBinding="mouseX" mouseYBinding="mouseY"}}
      <img src="images/dialogs/advisor.png" class="advisor">
      <h1>{{parentView.model.building.name}} L{{parentView.model.building.level}}</h1>
      <p>Next level does cost XYZ resources. It will need about X:XX.YY to build.</p>
    {{/view}}
  {{else}}
    {{#view AWE.UI.Ember.ToolTipView classNames="mouse-over" mouseXBinding="mouseX" mouseYBinding="mouseY"}}
      <img src="images/dialogs/advisor.png" class="advisor">
      <h1>Empty Building Site.</h1>
      <p>Click to build a new building here.</p>
    {{/view}}
  {{/if}} 
{{/if}}
{{#if "model.building"}}
  {{#if model.building.underConstruction}}
    <div class="level constructing">{{model.building.level}}</div>
  {{else}}
    {{#if model.building.underDestruction}}
      <div class="level destructing">{{model.building.level}}</div>
    {{else}}
      <div class="level">{{model.building.level}}</div>
    {{/if}}
  {{/if}}
{{/if}}
</script>

<script type="text/x-handlebars" data-template-name="fortress-info-box">
  <a href="#" {{action "changeNamePressed"}}>change name</a>
  <h1>{{name}}</h2>
  <p>{{defenseBonus}} | {{buildingSpeed}}</p>
</script>

<script type="text/x-handlebars" data-template-name="fortress-screen">
<div class="fortress-screen">
  <div class="fortress-picture">
    {{#if "fortress"}}
      {{#if "haveSlots"}}
        {{view AWE.UI.Ember.BuildingView classNames="buildings" levelBinding="wall.building.level"}}
        {{view AWE.UI.Ember.InteractiveBuildingView  classNames="tower tower-left" modelBinding="leftTower" settlementBinding="fortress"}}
        {{view AWE.UI.Ember.InteractiveBuildingView  classNames="tower tower-right" modelBinding="rightTower" settlementBinding="fortress"}}
        {{view AWE.UI.Ember.InteractiveBuildingView  classNames="wall"  modelBinding="wall" settlementBinding="fortress"}}
      {{/if}}
      {{#if queues }}
        {{view AWE.UI.Ember.ConstructionQueueView controllerBinding="controller" classNames="queue-list" queuesBinding="queues.collection"}}
      {{/if}}

      {{view AWE.UI.Ember.FortressInfoBoxView classNames="fortress-info-box" fortressBinding="fortress"}}
    {{/if}}

    {{#if selectedSlot}}
      {{#if selectedSlot.building }}
        {{view AWE.UI.Ember.BuildingDetailsDialog controllerBinding="controller" slotBinding="selectedSlot" buildingBinding="selectedSlot.building"}}
      {{else}}
        {{view AWE.UI.Ember.SelectBuildingDialog controllerBinding="controller" slotBinding="selectedSlot" constructionOptionsBinding="selectedSlot.constructionOptions"}}
      {{/if}}
    {{/if}}
    
  </div>
</div>
</script>


<script type="text/x-handlebars" data-template-name="settlement-dialog-select-building">
  <div class="settlement-dialog-background"></div>
  <div class="settlement-dialog-pane settlement-dialog-select-building">
    <a href="#" {{action "cancelPressed"}} class="cancel">close</a>
    <h1>{{ heading }}</h1>    
    <p>{{ message }}</p>
    {{#if constructionOptions }}
      {{#each constructionOptions}}
        {{#view Ember.View contentBinding="this" classNames="building-option" }}
          <div {{action "optionClicked" target="parentView"}}>
            {{view AWE.UI.Ember.BuildingView modelBinding="content" classNames="building-option-image"}}
            {{content.name}}<br>Level {{content.level}}
          </div>
        {{/view}}
      {{/each}}
    {{/if}}
    
  </div>
</script>


<script type="text/x-handlebars" data-template-name="settlement-dialog-building-details">
  <div class="settlement-dialog-background"></div>
  <div class="settlement-dialog-pane settlement-dialog-building-details">
    <a href="#" {{action "cancelPressed" }} class="cancel">close</a>
    {{#if building.level }}
      <h1>{{ building.name }} <span title="present level of building">Level {{ building.level }}</span>
          {{#if building.underConstruction }}(<span class="constructing" title="level after finishing all upgrades already in the queue">{{building.levelAfterJobs}}</span>){{/if}}
          {{#if building.underDestruction }}(<span class="destructing" title="level after finishing all downgrades already in the queue">{{building.levelAfterJobs}}</span>){{/if}}</h1>   
    {{else}}
      <h1>Under Construction: {{ building.name }}</h1>        
    {{/if}}
    {{view AWE.UI.Ember.BuildingView classNames="building-option-image" modelBinding="building"}}
    {{{building.description}}}

    {{#if building.unlockedQueues}}
      <p><b>Enables:</b> {{#each building.unlockedQueues}}{{local name}}, {{/each}}</p>
    {{/if}}
    
    {{#if building.speedupQueues}}
      {{#each building.speedupQueues}}
        <p><b>Speed bonus to {{local queueType.name}}:</b> {{ speedup }}%</p>
      {{/each}}
    {{/if}}
    
    <hr>
    
    {{#if building.upgradable}}
      <h2>Next Upgrade: Level {{ building.nextLevel }}</h2>
      <a href="#" {{action "upgradeClicked"}}>Upgrade</a>
    
     {{view AWE.UI.Ember.BuildingView classNames="building-option-image" modelBinding="building" levelBinding="building.nextLevel"}}

      ProductionTime: {{building.localizedProductionTimeOfNextLevel}}<br />
      {{#if building.costsOfNextLevel}}
        Costs:
        {{#each building.costsOfNextLevel}}
          {{amount}} {{local resourceType.name}} &nbsp;  
        {{/each}}
        <br/>
      {{/if}}
    
      {{#if building.unlockedQueuesNextLevel}}
        <p><b>Enables:</b> {{#each building.unlockedQueuesNextLevel}}{{local name}}, {{/each}}</p>
      {{/if}}
    
      {{#if building.speedupQueuesNextLevel}}
        {{#each building.speedupQueuesNextLevel}}
          <p><b>Speed bonus to {{local queueType.name}}:</b> {{ speedup }}%</p>
        {{/each}}
      {{/if}}
    {{else}}
      <p><b>Cannot be upgraded further.</b></p>
    {{/if}}
    
    <hr>

    {{#each building.trainingQueues }}
      {{view AWE.UI.Ember.TrainingQueueView controllerBinding="controller" classNames="training-queue-list" queueBinding="this"}}
    {{/each}}

  </div>
</script>

<script type="text/x-handlebars" data-template-name="trainable-unit-button">
  {{local unitType.name}}
</script>

<script type="text/x-handlebars" data-template-name="training-queue-view">
  <h2>{{local queue.queueType.name }}</h2>

  <div class="clearfix">
    {{#each trainableUnitTypes}}
      {{view AWE.UI.Ember.TrainableUnitButtonView unitTypeBinding="this" queueBinding="view.queue" classNames="training-option"}}
    {{/each}}
  </div>

  Per Unit:
    {{#each costs}}
      {{amount}} {{local resourceType.name}} &nbsp;  
    {{/each}}    
    Duration: {{localizedProductionTime}}
  <br />
  Total:
    {{#each totalCosts}}
      {{amount}} {{local resourceType.name}} &nbsp;  
    {{/each}}    
    Duration: {{localizedTotalProductionTime}}
  <br />  

  
  {{view Ember.TextField valueBinding="number"}} <a href="#" class="button" {{action "createJobPressed"}}>Train {{local selectedUnitType.name}}</a>    

  <div class="training-queue-list-pane">    
    {{#unless queue.empty }}
      {{#each queue.hashableJobs.collection }}
        {{#view AWE.UI.Ember.TrainingJobView controllerBinding="controller" jobBinding="this" classNames="training-queue-job"}}
          <div class="training-queue-job-text">    
            <p>{{ job.quantity }} {{local job.unitType.name }}</p>
            {{#if job.active_job }}
            <p>Fin: {{ job.parsedFinishingTotalDate }}</p>
            <p>Finished: {{ job.active_job.quantity_finished }}</p>
            <p>Current: {{ job.active_job.quantity_active }}</p>
            <p>{{ job.parsedFinishingActiveDate }}</p>
            {{/if}}
          </div>  
          <div class="training-queue-job-button">    
            <a href="#" {{action "cancelJobPressed"}}>cancel</a>
          </div>  
        {{/view}}
      {{/each}}
    {{/unless}}
  </div>
</script>


<script type="text/x-handlebars" data-template-name="construction-queue-view">
  <div class="queue-list-pane">
    {{#each queues}}
      {{#view Ember.View controllerBinding="controller" queueBinding="this" classNames="queue"}}
      <h1>{{local queue.queueType.name}}</h1>
        {{#unless queue.empty }}
        <div class="queue-job-list">    
          {{#each queue.hashableJobs.collection }}
            {{#view AWE.UI.Ember.ConstructionJobView controllerBinding="controller" jobBinding="this" classNames="queue-job"}}
              {{view AWE.UI.Ember.BuildingView classNames="queue-job-image" levelBinding="job.level_after" buildingIdBinding="job.buildingId" typeBinding="job.slot.building.type"}}
              <div class="queue-job-text">    
                <p>{{ job.job_type }}</p>
                <p>{{ job.slot.building.name }}</p>
                <p>Slot #{{ job.slot.slot_num }}</p>
                <p>Level {{ job.level_after }}</p>
                <p>{{#if job.active_job }}Fin.: {{ job.parsedFinishingDate }}{{/if}}</p>
              </div>  
              {{#if job.cancelable }}
              <div class="queue-job-button">    
                <a href="#" {{action "cancelJobPressed"}}>cancel</a>
              </div>  
              {{/if}}
            {{/view}}
          {{/each}}
        </div>  
        {{/unless}}
        {{#if queue.empty }}
        <div class="queue-job-list empty">    
           <p>This construction queue is empty</p>
        </div>  
        {{/if}}
      {{/view}}
    {{/each}}
  </div>
</script>

